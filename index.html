<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Matrix Transformation on Image Pixels</title>
<style>
body { font-family: Arial; background:#f4f4f4; text-align:center; }
canvas { border:1px solid black; margin:10px; }
.controls { margin:10px auto; width:900px; background:white; padding:10px; border-radius:8px;}
.sliderRow { display:flex; align-items:center; justify-content:space-between; margin:5px 0;}
label { width:20px; }
.value { width:50px; }
</style>
</head>
<body>

<h2>Matrix Transformation on Image Pixels</h2>

<div class="controls">
<input type="file" id="upload">

<div class="sliderRow"><label>a</label><input type="range" id="a" min="-2" max="2" step="0.01" value="1"><span id="aVal" class="value"></span></div>
<div class="sliderRow"><label>b</label><input type="range" id="b" min="-2" max="2" step="0.01" value="0"><span id="bVal" class="value"></span></div>
<div class="sliderRow"><label>c</label><input type="range" id="c" min="-2" max="2" step="0.01" value="0"><span id="cVal" class="value"></span></div>
<div class="sliderRow"><label>d</label><input type="range" id="d" min="-2" max="2" step="0.01" value="1"><span id="dVal" class="value"></span></div>

<button onclick="setRotation()">Rotation</button>
<button onclick="setShear()">Shear</button>
<button onclick="setScale()">Scale</button>
<button onclick="setReflection()">Reflect</button>
<button onclick="resetMatrix()">Reset</button>
</div>

<canvas id="original" width="400" height="400"></canvas>
<canvas id="transformed" width="400" height="400"></canvas>

<script>
const origCanvas = document.getElementById("original");
const transCanvas = document.getElementById("transformed");
const octx = origCanvas.getContext("2d");
const tctx = transCanvas.getContext("2d");

let img = new Image();
img.src = "https://upload.wikimedia.org/wikipedia/commons/3/3f/JPEG_example_flower.jpg";
img.crossOrigin="anonymous";

let trackPoint = {x:200, y:200};

document.getElementById("upload").onchange = e=>{
  let reader = new FileReader();
  reader.onload = ev => img.src = ev.target.result;
  reader.readAsDataURL(e.target.files[0]);
};

img.onload = ()=> draw();

function getMatrix(){
  return {
    a:+a.value, b:+b.value,
    c:+c.value, d:+d.value
  };
}

function drawGrid(ctx){
  ctx.strokeStyle="lime";
  for(let x=0;x<400;x+=40){
    ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,400); ctx.stroke();
  }
  for(let y=0;y<400;y+=40){
    ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(400,y); ctx.stroke();
  }
}

function drawBasis(ctx,m){
  ctx.strokeStyle="red"; ctx.lineWidth=3;
  ctx.beginPath(); ctx.moveTo(200,200); ctx.lineTo(200+100*m.a,200+100*m.c); ctx.stroke();
  ctx.strokeStyle="blue";
  ctx.beginPath(); ctx.moveTo(200,200); ctx.lineTo(200+100*m.b,200+100*m.d); ctx.stroke();
}

function draw(){
  let m = getMatrix();

  aVal.textContent=m.a.toFixed(2);
  bVal.textContent=m.b.toFixed(2);
  cVal.textContent=m.c.toFixed(2);
  dVal.textContent=m.d.toFixed(2);

  octx.clearRect(0,0,400,400);
  octx.drawImage(img,0,0,400,400);
  drawGrid(octx);
  octx.fillStyle="yellow";
  octx.beginPath(); octx.arc(trackPoint.x,trackPoint.y,5,0,Math.PI*2); octx.fill();

  let imageData=octx.getImageData(0,0,400,400);
  let out=tctx.createImageData(400,400);
  let inv = invert(m);

  for(let x=0;x<400;x++){
    for(let y=0;y<400;y++){
      let dx=x-200, dy=y-200;
      let sx=inv.a*dx+inv.b*dy+200;
      let sy=inv.c*dx+inv.d*dy+200;
      if(sx>=0&&sy>=0&&sx<400&&sy<400){
        let si=(Math.floor(sy)*400+Math.floor(sx))*4;
        let di=(y*400+x)*4;
        out.data[di]=imageData.data[si];
        out.data[di+1]=imageData.data[si+1];
        out.data[di+2]=imageData.data[si+2];
        out.data[di+3]=255;
      }
    }
  }

  tctx.putImageData(out,0,0);
  drawGrid(tctx);
  drawBasis(tctx,m);

  let tp = transform(trackPoint,m);
  tctx.fillStyle="yellow";
  tctx.beginPath(); tctx.arc(tp.x,tp.y,5,0,Math.PI*2); tctx.fill();
}

function transform(p,m){
  let dx=p.x-200, dy=p.y-200;
  return {x:m.a*dx+m.b*dy+200, y:m.c*dx+m.d*dy+200};
}

function invert(m){
  let det=m.a*m.d-m.b*m.c || 0.0001;
  return {a:m.d/det, b:-m.b/det, c:-m.c/det, d:m.a/det};
}

function setRotation(){let t=Math.PI/6; a.value=Math.cos(t); b.value=-Math.sin(t); c.value=Math.sin(t); d.value=Math.cos(t); draw();}
function setShear(){a.value=1;b.value=1;c.value=0;d.value=1;draw();}
function setScale(){a.value=1.5;d.value=1.5;b.value=0;c.value=0;draw();}
function setReflection(){a.value=-1;d.value=1;b.value=0;c.value=0;draw();}
function resetMatrix(){a.value=1;b.value=0;c.value=0;d.value=1;draw();}

document.querySelectorAll("input").forEach(el=>el.oninput=draw);
origCanvas.onclick=e=>{trackPoint={x:e.offsetX,y:e.offsetY};draw();};
</script>

</body>
</html>
